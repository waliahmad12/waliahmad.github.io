import { useState, useEffect } from "react"; import { Card, CardContent } from "@/components/ui/card"; import { Button } from "@/components/ui/button"; import { Input } from "@/components/ui/input"; import { LineChart, Line, CartesianGrid, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend } from "recharts";

export default function ExpenseTracker() { const [members, setMembers] = useState([ "Md Wali Ahmad", "Md Taufiq Iman", "Md Faizan", "Altamash", "Md Nadim", "Zargam Sher", "Md Raqib", ]);

const [expenses, setExpenses] = useState([]); const [amount, setAmount] = useState(""); const [desc, setDesc] = useState(""); const [payer, setPayer] = useState(""); const [perPersonDeposit, setPerPersonDeposit] = useState(1500);

// Load from localStorage useEffect(() => { const savedExpenses = localStorage.getItem("expenses"); if (savedExpenses) setExpenses(JSON.parse(savedExpenses)); const savedMembers = localStorage.getItem("members"); if (savedMembers) setMembers(JSON.parse(savedMembers)); }, []);

// Save to localStorage useEffect(() => { localStorage.setItem("expenses", JSON.stringify(expenses)); localStorage.setItem("members", JSON.stringify(members)); }, [expenses, members]);

const totalDeposit = members.length * perPersonDeposit; const totalExpense = expenses.reduce((a, b) => a + b.amount, 0); const balance = totalDeposit - totalExpense;

// Individual balances const memberBalances = members.map((m) => { const paid = expenses .filter((e) => e.payer === m) .reduce((a, b) => a + b.amount, 0); const share = totalExpense / members.length; return { name: m, paid, share, balance: paid - share }; });

const addExpense = () => { if (!amount || !payer) return; setExpenses([ ...expenses, { id: Date.now(), amount: parseInt(amount), desc: desc || "General", payer, date: new Date().toLocaleDateString() }, ]); setAmount(""); setDesc(""); setPayer(""); };

const removeExpense = (id) => { setExpenses(expenses.filter((e) => e.id !== id)); };

const exportCSV = () => { const rows = ["Date,Description,Payer,Amount", ...expenses.map(e => ${e.date},${e.desc},${e.payer},${e.amount})]; const blob = new Blob([rows.join("\n")], { type: "text/csv" }); const url = window.URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "expenses.csv"; a.click(); };

const COLORS = ["#0088FE", "#00C49F", "#FFBB28", "#FF8042", "#A020F0", "#FF1493", "#2E8B57"];

return ( <div className="min-h-screen bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 p-6 text-white"> <h1 className="text-3xl font-bold text-center mb-6">üçΩÔ∏è Room Expense Tracker</h1>

{/* Deposit Config */}
  <Card className="mb-6 bg-white/20 backdrop-blur-md shadow-lg">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">‚öôÔ∏è Settings</h2>
      <div className="flex gap-2">
        <Input
          type="number"
          placeholder="Deposit per person"
          value={perPersonDeposit}
          onChange={(e) => setPerPersonDeposit(parseInt(e.target.value))}
          className="bg-white text-black"
        />
        <Button onClick={() => setMembers([...members, `Member ${members.length + 1}`])} className="bg-blue-600 hover:bg-blue-700">
          + Add Member
        </Button>
      </div>
    </CardContent>
  </Card>

  {/* Expense Input */}
  <div className="grid grid-cols-1 md:grid-cols-5 gap-2 mb-6">
    <Input
      type="number"
      placeholder="Enter daily expense"
      value={amount}
      onChange={(e) => setAmount(e.target.value)}
      className="bg-white text-black"
    />
    <Input
      type="text"
      placeholder="Description"
      value={desc}
      onChange={(e) => setDesc(e.target.value)}
      className="bg-white text-black"
    />
    <select
      value={payer}
      onChange={(e) => setPayer(e.target.value)}
      className="bg-white text-black rounded p-2"
    >
      <option value="">Select Payer</option>
      {members.map((m, i) => (
        <option key={i} value={m}>{m}</option>
      ))}
    </select>
    <Button onClick={addExpense} className="bg-green-600 hover:bg-green-700">
      Add
    </Button>
    <Button onClick={exportCSV} className="bg-yellow-600 hover:bg-yellow-700">
      Export CSV
    </Button>
  </div>

  {/* Summary */}
  <Card className="bg-white/20 backdrop-blur-md shadow-lg mb-6">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">üìä Summary</h2>
      <p>Total Deposit: <b>{totalDeposit} Rs</b></p>
      <p>Total Expense: <b>{totalExpense} Rs</b></p>
      <p>Remaining Balance: <b>{balance} Rs</b></p>
    </CardContent>
  </Card>

  {/* Member Balances */}
  <Card className="bg-white/20 backdrop-blur-md shadow-lg mb-6">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">üí∞ Member Balances</h2>
      <ul className="list-disc ml-5">
        {memberBalances.map((mb, i) => (
          <li key={i}>
            {mb.name}: Paid <b>{mb.paid} Rs</b>, Share <b>{mb.share.toFixed(0)} Rs</b>, Balance <b>{mb.balance.toFixed(0)} Rs</b>
          </li>
        ))}
      </ul>
    </CardContent>
  </Card>

  {/* Expense History */}
  <Card className="bg-white/20 backdrop-blur-md shadow-lg mb-6">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">üìù Expense History</h2>
      <ul className="list-decimal ml-5">
        {expenses.map((exp, i) => (
          <li key={exp.id} className="flex justify-between items-center">
            <span>Day {i + 1} ({exp.date}): {exp.amount} Rs ‚Äî {exp.desc} (Paid by {exp.payer})</span>
            <Button onClick={() => removeExpense(exp.id)} className="bg-red-600 hover:bg-red-700 ml-2">‚ùå</Button>
          </li>
        ))}
      </ul>
    </CardContent>
  </Card>

  {/* Expense Trend Chart */}
  <Card className="bg-white/20 backdrop-blur-md shadow-lg mb-6">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">üìà Expense Trend</h2>
      <div className="h-64">
        <ResponsiveContainer width="100%" height="100%">
          <LineChart data={expenses.map((e, i) => ({ day: i + 1, amount: e.amount }))}>
            <Line type="monotone" dataKey="amount" stroke="#fff" strokeWidth={2} />
            <CartesianGrid stroke="#ccc" strokeDasharray="5 5" />
            <XAxis dataKey="day" stroke="#fff" />
            <YAxis stroke="#fff" />
            <Tooltip />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </CardContent>
  </Card>

  {/* Member Contribution Pie Chart */}
  <Card className="bg-white/20 backdrop-blur-md shadow-lg">
    <CardContent>
      <h2 className="text-xl font-semibold mb-2">ü•ß Member Contributions</h2>
      <div className="h-64">
        <ResponsiveContainer width="100%" height="100%">
          <PieChart>
            <Pie data={memberBalances} dataKey="paid" nameKey="name" cx="50%" cy="50%" outerRadius={100} label>
              {memberBalances.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
              ))}
            </Pie>
            <Tooltip />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </div>
    </CardContent>
  </Card>
</div>

); }

